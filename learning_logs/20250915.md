id : root
pwd : 1234
Service Name : MariaDB
TCP port : 3306

# 새로운 DB 생성 방법

세션 우클릭 -> 새 데이터 베이스 생성

1. play_sql DB 생성
2. data폴더의 csv파일 가져오기

# RDBMS

RDBMS(Relational DataBase Management System : 관계형 데이터 베이스 관리 시스템)는 데이터를 관계형 모델을 기반으로 저장, 관리, 조작하는 소프트웨어 시스템. 관계형 모델은 데이터를 테이블( 릴레이션) 형식으로 표현하며, 각 테이블은 행(row), 열(column)로 구성됩니다. RDBMS는 데이터 무결성 / 일관성 / 보안 등을 유지하면서 데이터를 효율적으로 관리하고 접근할 수 있게 보조한다.

## 주요 특징

1. 테이블 기반 구조:

   - 데이터는 행 과 열로 구성된 테이블에 저장됩니다.
   - 각 테이블은 고유의 이름을 가지며, 데이터베이스 내에서 다른 테이블과 관계를 맺을 수 있습니다.

2. SQL 사용

   - RDBMS는 데이터를 정의하고 조작하기 위해 SQL(Structured Query Language)을 사용합니다.
   - SQL은 데이터베이스 생성 / 테이블 생성 / 데이터 삽입 / 수정 / 삭제 / 조회 등의 조작을 위한 표준 언어입니다.

3. 데이터 무결성
   - 데이터의 정확성과 일관성을 유지하기 위해 무결성 제약 조건(Prmary Key, Foreign Key, Unique, Check 등)을 지원합니다. 특히 우리는 PK / FK 개념이 중요하다.
   - 트랜잭션 처리(ACID) 를 통해 데이터 무결성을 보장합니다.
4. 관계설명
   - 테이블 간의 광계를 성정하여 데이터의 중복을 최소화하고, 데이터의 참조 무결성을 유지합니다.
   - 관계의 유형으로 일대일 / 일대다/ 다대다가 있습니다.
5. 데이터 보안
   - 사용자 권한 관리 / 데이터 암호와 등을 통해 데이터 베이스 보안을 강화합니다.
   - 각 사용자는 데이터베이스 / 테이블 / column 단위로 접근 권한을 설정할 수 있습니다.

## RDBMS의 주요 기능

- 데이터 정의 : 테이블 / 뷰 / 인덱스 / 스키마 등을 생성하고 관리
- 데이터 조작 : 데이터 삽입 / 수정 / 삭제 / 조회를 수행
- 데이터 제어 : 트랜잭션 관리 / 동시성 제어 / 회복 기능을 제공
- 데이터 보안 : 사용자 권한 설정 / 데이터 암호화 / 감사 로그 등을 지원

# SQL 학습

## 정의

- 구조화된 질문 언어 : RDBMS를 관리하기 위해 고안된 프로그래밍 언어

### SQL은 어떻게 실행되는가?

- 컴퓨터에게 특정 데이터 정보를 가지고 오라고 명령할 때 필요한 정보
  1. '무엇'을 가지고 와야 하는지.
  2. '어디에서' 가져와야 하는지.
- 이상의 최소한의 정보들을 포함하여 컴퓨터가 알아 들을 수 있고 / 또 사람이 알아볼 수 있는 형태로 구현한 것이 SQL

```sql
SELECT * FROM users;
```

그리고 이상의 SQL문 실행하는 것을 우리나라에서는 _쿼리문_ 을 실행했다, 날렸다 등의 표현을 씁니다.
Springboot 상황에서는 Query Method라고 해서 SQL문과는 다르지만 Java 내에서 method 형태로 명령어를 정의하고, 이것을 호출 했을 때 MariaDB로 접속하여 특정 데이터를 가지고 오도록 제어할 예정.

# SQL의 종류

1. DML(Data Manipulation Language) : 데이터 조작 언어라는 뜻으로, 데이터베이스의 내부 데이터를 관리하기 위한 기능. 주로 데이터를 조회하고 추가하고 , 수정하거나 삭제하는 등의 기능을 수행하기 위하여 사용됨. SELECT/ INSERT/ UPDATE/ DELETE 등이 있습니다.
   - 그리고 이상의 생성 / 조회 / 수정 / 삭제를 CRUD라고도 합ㄴ디ㅏ.
     - C : Create
     - R : Read
     - U : Update
     - D : Delete
2. DDL(Data Definition Language) : 데이터 정의 언어라는 뜻으로, 관계형 데이터베이스 내의 저장 단위잉ㄴ 테이블(table)과 컬럼(column)을 정의하고 관리하는 멸령어를 포함한다. 저장 공가능ㄹ 생성하고, 수정하거나 삭제하는 등의 주로 데이터 저장 공간을 결정하는 기능에 해당한다.
   - CREATE
   - DROP
   - TRUNCATE
3. DCL(Data Control Language) : 관리목적으로 주로 사용되며, 데이터 베이스에 접근하려는 사용자의 권한을 관리하거나 보안과 관련된 기능을 담당한다. 주요 명령어로는 GRABT / REVOKE 등이 있습니다.
4. TCL(Transaction Control Language) : 트랜잭션 제어 언어라는 의미로, 데이터베이스를 조작하는 명령 단위인 트랜잭션을 관리할 때 사용하는 기능이다. 주용 명령어로는 COMMIT / ROLLBACK 등이 있다.

# 주요 용어

1. 테이블 (table)

   - 관계형 데이터베이스 내에서 행과 열로 구성된 데이터를 저장하는 기본 단위.
   - 액셀을 하나의 데이터베이스라고 한다면 테이블은 액셀 내에서의 sheet로 볼 수 있다.
   - 각 테이블은 고유한 식별자인 기본 키를 가지고 있다.
   - 기본 키는 테이블 내에서 각 행을 고유하게 식별하기 위해 사용한다.
   - 테이블 간의 관계를 맺을 때는 외래 키를 사용한다.

2. 컬럼(column)

   - 데이터에서 하나의 속성에 해당하는 데이터를 저장하는 공간으로, 새로 줄인 열에 해당한다.
   - 각 컬럼에는 칼럼명 / 데이터 타입 / 크기 / 제약 조건 등을 정의할 수 있다.

3. 행(row)

   - 테이블에서 가로줄 하나를 의미한다. Record라고 부르기도 합니다.
   - 테이블에서 하나의 개별 데이터 단위를 나타내며, 특정 데이터가 저장되고 조회될 때 행 단위로 처리된다.

4. 기본 키(Primary Key : PK)

   - 기본 키는 테이블에서 각 행(객체)을 고유하게 식별할 수 있는 값
   - 기본 키는 하나가 아닌 여러 값의 조합으로 이루어질 수도 있으며, 이러한 기본 키는 테이블 내에서 중복되지 않는 유일한 값이어야 한다.

5. 외래 키(Foreign Key / FK)
   - 외래 키는 다른 테이블의 기본키와 매칭되어 해당 테이블과의 관계를 정의한다.
   - 다른 테이블의 기본 키 값을 가져와서 컬럼을 구성하며 이후 테이블 끼리 결합(JOIN 연산 수행)할 때 사용된다.
   - 일반적으로 다른 테이블의 기본 키와 같은 데이터 아입과 크기 (int / long)를 갖는다.

# SQL 문의 예시 설명

1. DDL
   - CREATE / ALTER / DROP
   - 테이블 생성 삭제 명령어

```sql
CREATE TABLE users(
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL,
  email VARCHAR(100) NOT NULL
)
```

이상을 자바로 표현하면

```java
public class User{
  @NonNull
  private int id;
  @NonNull
  private String username;
  @NonNull
  private String email;
}
```

2. DML
   - 주요 명령어 : INSERT / SELECT / DELETE / UPDATE
   - 예시

```sql
INSERT INTO users (username, email) VALUES ('홍길동', 'honggildon@test.com');
```

```SQL
SELECT
```

# 원하는 데이터를 가져오고 필터링 하는 법

## 데이터 처리 4 요소 : 생성 / 조회 / 수정 / 삭제

일단 조회에 관한 학습 위주이다.

### SELECT

1. 사전에 미리 데이터들이 있다고 가정할 때, 가장 중요한 부분으로 '어떤 데이터를 어디에서' 가지고 올까와 관련된 구문.

```sql
SELECT 'hello world'
```

```sql
select 12 + 7;
```

그래서 현재의 특정 테이블과 관계 없는 상황에서 string 값을 사용한다든지 혹은 연산을 하는 것도 가능합니다.

기본예제
결과 창의 첫 행에 Find / Insight / with SQL을 3개의 간에 걸쳐 순서대로 출력해 보겠습니다.
첫 번째 컬럼명을 Find
두 번째 컬럼명은 Insight
세 번째 컬럼명은 With SQL

```sql
SELECT
'Find' AS 'First',
'Insight' AS 'Second',
'With SQL' AS 'Third';
```

와 같은 방식을 AS 명령어를 사용하게 되면 각 row에 대한 column명을 지정할 수 있다.

연습 문제

1. SELECT를 이용하여 28 + 891 의 결과를 표기하라
2. SELECT를 이용하여 19 x 27의 결과를 표시하라. 단, 컬럼명은 Result로 표시
3. SELECT를 이용 3가지의 결과 표시
   - 37 - 172 (컬럼명 Plus)
   - 25 x 78 (컬럼명 Times)
   - I Love SQL! (컬럼명 Result)

```sql
SELECT 28 + 891;
SELECT 19 * 27 AS Result;
SELECT
	37 + 172 AS Plus,
	25 * 78 AS Times,
	'I Love SQL!' AS Result;
```

이상은 String 데이터 (MariaDB 기준으로는 VARCHAR의 경우)는 큰 따옴표든 작은 따옴표든 구분하지 않는다.
컴럼명을 지정할 때는 따옴표는 필요하지 않지만 따옴표를 넣는 것을 권장한다.

### FROM

- 데이터가 저장되 위치를 알려주는 전치사

1.

```sql
SELECT * FROM users;
```

- `*` : 와일드 카드라고도 하고, 애스터리스크라고도 합니다. sql문에서는 모든 컬럼을 나타내는 표현입니다.

```sql
SELECT *
  FROM products;
```

명령문 내에서 개행이 일어나도 결과값에서는 차이가 없다.
다만 개발자들끼리는 적절한 개행을 통해 가독성있는 SQL을 쓰는 것을 원칙으로 한다.

```sql
SELECT *
  FROM products
  LIMIT 3
  ;
```

아까까지는 저체 테이블을 all rows를 다 불러 왔ㄴ느데, 모든 정보를 조회하는 것을 full scan이라는 표현을 씁니다. 그런데 테이블에 데이터가 엄청나게 많다면 불러오는데에 컴퓨터가 많은 리소스를 쓰기 때문에 작업이 원할하지 않을 수 있어 full scan 자체는 지양되는 편입니다. 그래서 단순히 데이터의 상태를 파악하고 싶다ㅕㄴ LIMIT을 추가하여 일부 데이터만 확인하는 습과능ㄹ 들이는 것이 좋다.

- MariaDB에서는 LIMIT을 쓰지만 Oracle / MySQL 에서는 TOP 명령어를 상요합니다.

연습문제
products 테이블에서 제품아이디, 제품명 컬럼의 데이터들만 상위 30개만 추출하는 SQL문을 작성

```sql
SELECT id , name
  FROM products
  LIMIT 30
  ;
```

1. orderdetails 테이블의 전체 컬럼을 표시
2. users에서 상위 7건의 데이터 표시
3. orders에서 주문 아이디 / 회원 아이디 / 주문 일자 컬럼의 모든 데이터 표시

### WHERE

- 조건식을 사용할 때 사용
- SELECT / FROM을 통해서 어떤 테이블의 어떤 컬럼을 보여줄 지를 정했다. 여기서 특정 조건만 가지고 온다고 할 때 사용하는 명령어이다.
- 예를 들어, 특정 컬럼의 값이 A인 값만 가지고 온다던지, 마케팅 동의한 회원의 정보만 가지고 온다던지 등 조건을 만족시키는 데이터만 조회하느 것이다.
- SELECT에서는 테이블의 세로 부분인컬럼을 제어했다면 WHERE 절에서는 테이블의 가로부분인 row를 제어하게 된다.

회원 정보 테이블 users에서 거주국가가 korea이면서, 동시에 마케팅 수신 동의를 동의한 데이터를 추출

```sql
SELECT *
	FROM users
	WHERE
		country = 'Korea'
	 and
		is_marketing_agree = 1
	;
```

회원정보 테이블 users에서 거주 국가가 korea가 아닌 데이터를 추출하는 쿼리문을 작성하시오

```sql
SELECT *
	FROM users
	WHERE
		country != 'Korea'
	;
```

회원 정보 테이블에서 거주국가가 한국이면서 id가 10인 회원만 추출하시오

```sql
SELECT *
	FROM users
	WHERE
		country = 'Korea'
	  and
		id = 10
    ;
```

회원정보 users에서 가입 일시 (created_at ) 2010-12-01 부터 2011-01-01까지인 회원정보를 출력하기

```sql
SELECT * FROM users WHERE created_at BETWEEN '2010-12-01' AND '2011-01-01';
```

- `BETWEEN A AND B` : A와 B 사이
  - A : 시작
  - B : 종료

```sql
SELECT *
  FROM users
  WHERE created_at >= '2010-12-01'
;
```

회원정보 테이블 users에서 가입일시가 2010-12-01 부터 2011-03-01까지인 회원정보를 BETWEEN을 사용하지 않고 출력

```sql
SELECT *
  FROM users
  WHERE created_at >= '2010-12-01' AND created_at <= '2011-03-01'
;
```

회원 정보 테이블 users에서 거주국가가 한국이거나 UK거나 USA인 회원정보만 추출 하시오.

```sql
SELECT * FROM users WHERE country = 'Korea' OR country = 'UK' OR country = 'USA';
```

SELECT / FROM / WEHEE / BETWEEN A AND B / AND / OR
까지 사용
IN 사용 하면

```sql
SELECT * FROM users WHERE country IN ('Korea', 'UK', 'USA') ORDER BY country;
```

python에서도 for / if문 쓸 때 확인 하셨겠지만 IN의 의미는 IN뒤에 오는 리터럴 내에 있는 이라는 의미가 된다.
그래서 WHERE은 굳이 프로그래밍 언어에 따르면 조건식이라는 표현에서도 알 수 있듯이 if로 봐도 무방하다.

거주국가가 한국이거나 UK거나 USA가 아닌 회원정보 추출

```sql
SELECT * FROM users WHERE country NOT IN ('Korea', 'UK', 'USA')  ORDER BY country;
```

users에서 country 이름이 S로 시작하는 회원정보 추출하기

```sql
SELECT * FROM users WHERE country LIKE 'S%';
```

이상의 SQL문이 중요한 이유가 뭐냐면 게신판 같은거 할 때 filtering을 할 때 사용한다.
예로 제목에 'SQL'이 포함되어있는지

```sql
SELECT * FROM aricles WHERE title LIKE '%SQL%';
```

제목 + 내용에도 '쿼리'가 포함 되어 있는지

```sql
SELECT * FROM aricles WHERE title LIKE '%쿼리%' OR content LIKE '%쿼리%';
```

- `LIKE` : 기존에 사용한 연산자들은 컬럼값이 조건값과 정확히 일치해야하는 반면, LIKE WHERE에 조건문을 작성할 때 일부 패턴에 일치하는 데이터도 가지고 올 수 있다는 점에서 매우 유용
  - LIKE 뒤에 '작은 따옴표/ 큰 따옴표' 내에서는 와일드 카드를 사용할 수 있는데, 특히 LIKE가 오면 와일드 카드가 오겠다고 생각하면 된다.
  - 와일드카드 `%`는 0개 이상의 임의의 문자열을 의미하는 메타 문자로 사용된다.
  - `_`는 한개의 임의의 문자를 나타낸다.
  - `[]` : 대괄호 내의 문자 집합 중 일치하는 1개의 문자를 나타냄

회원 정보 테이블 users에서 거주국가가 이름이 S로 시작하지 않는 회원정보 추출

```sql
SELECT * FROM users WHERE country NOT LIKE 'S%';
```

- WHERE은 조건을 만족하는 데이터만 가져오도록 제한한다 (row 기준이라는 측면에서 SELECT와 차이가 있다)
- FROM이 끝난 뒤에 위치한다.
- WHERE 을 사용하여 필터링하면 조건에 맞는 row만 선택되어 출력된다.
- 행 단위로 필터링이 적용되며, WHERE을 통해 조건을 지정하면 해당 조건에 부합하는 행만 출려된다.
- WHERE 컬럼명 연산자 조건값의 순서로 이루어 진다.
- 한 가지 이상의 조건을 개수 제한 없이 동시에 사용할 수 있으며, 개별 조건을 연결할 때는 놀리 연산자인 AND / OR 을 사용한다.
- IN / LIKE / % 의 개념도 필수적으로 알아 둘 수 있도록 한다.

### 연습문제

1. 회원 정보 테이블에서 거주 국가가 멕시코인 회원정보를 추출한다. (단, 가입일시, 연락처, 거주도시, 거주 국가 컬럼만)

   ```sql
   SELECT created_at, phone, city, country FROM users WHERE country = 'Mexico';
   ```

2. 제품 정보 테이블 products에서 제품 아이디가 20이하이고, 정상가격은 30이상인 제품의 정보를 추출하라. 단, 기존 컬럼을 모두 출력하고, 정상 가격에서 얼마나 할인 되었는지를 discount_amount라는 컬럼으로 추가

   ```sql
   SELECT * , price-discount_price AS discount_amount FROM products WHERE price > 30 AND id <= 20;
   ```

3. users에서 거주 국가가 한국도 캐나다고 벨기에도아닌 회원의 정보를 모두 추출하여라 (OR 연산자 사용 X)

   ```sql
   SELECT * FROM users WHERE country NOT IN ('Korea','Canada','Belgium');
   ```

4. products 에서 제품명이 N으로 시작하는 제품의 정보를 추출하라. 단 id / name / price 컬럼만 출력

   ```sql
   SELECT id, products.`name`, price FROM products WHERE products.`name` LIKE 'N%';
   ```

5. 주문 정보 테이블 orders에서 주문 일자가 2015-07-01 부터 2015-10-31까지가 아닌 정보만 추출
   ```sql
   SELECT * FROM orders WHERE order_date NOT BETWEEN '2015-07-01' AND '2015-10-31'
   ```

## OREDR BY

- 특정 컬럼을 기준으로 오름차순 / 내림차순으로 할 것인지를 결정 짓는 것이다.
  예시

```sql
SELECT * FROM users ORDER BY city ASC ;
```

거주 도시 기준 오름차순 (ASCII CODE 기준)

- GUI 형태는 마우스로 오름/내림차순으로 조작이 가능하다.

```sql
SELECT * FROM users ORDER BY city DESC ;
```

거주 도시 기준 내림차순 (ASCII CODE 기준)

users에서 가입 일시 기준으로 오름차순 정렬하여 전체 컬럼 출력

```sql
SELECT * FROM users ORDER BY created_at ASC ;
```

users에서 username / phone / city / country / id 칼럼 순서대로 출력하는데 ,결과를 첫번째 컬럼 기준으로 오름 차순

```sql
SELECT username, phone, city , country, id FROM users ORDER BY 1 ASC ;
```

user에서 city / id 컬럼만 추출 , 거주 도시 기준으로 내림 차순 / 회원아이디 기준 오름차수

```sql
SELECT city , id FROM users ORDER BY city DESC, id ASC ;
```

ORDER BY 문에서는 복수의 정룔 조건이 나열 될 때에는 ','를 기준으로 작성하면 된다. 그러면 출력 결과를 보기전에 해석하기로는 city 칼럼 먼저 ,id 칼럼이 뒤에 나오는데, city칼럼을 먼저 정렬하고 동일한 정렬 값 내부에서 후에 나오는 id기준으로 정렬된다.

연습문제

1. 제품 정보 테이블에서 정상 가격이 비싼 제품부터 순서대로 모든 칼럼을 출력하시오.

2. 주문정보 테이블에서 주문 일자 기준으로 최신 순으로 정렬하여 모든 컬럼을 출력하시오.

3. 주문 상세 정보 테이블 orderdetails에서 먼저 제품 아이디를 기준으로 내림차순 정렬하고, 같은 제품 아이디 내에서는 판매 수량 값을 기준으로 오름 차순 정렬하여 모든 컬럼을 출력하시오

# SQL 실무 예시

SELECT / FROM / WHERE / ORDER BY

- 배달 서비스에서 어떻게 추출 하는가?

1. 2023-08-01에 주문한 내역 중 쿠폰 할인이 적용된 내역만 추출

```sql
SELECT * FROM 주문정보
  WHERE 주문일자 = '2023-08-01'
    AND 쿠폰 할인 금액 > 0;
```

2. 마포구에서 1인분 배달이 가능한 배달 음식점만 추출

```sql
SELECT * FROM 음식점정보
  WHERE 지역 = '마포구'
    AND 1인분가능여부 = 1;
```

여기서 0 / 1은 boolean 자료형이라고 생각하면 되겠습니다.
예시라서 적는 참조 사항 : 오늘 일자를 가져오는 부분과 특정 일자에서 한달을 차감하는 등의 함수가 DB 별로 다르게 설정되어 있기 때문에 참고만 하자.

- 전자책 서비스에서의 적용사례

1. 출간된지 한 달 이내인 신간 중 페이지 수가 200 이상인 도서만 추출

```sql
SELECT * FROM 도서 정보
  WHERE 출간일자 >= (오늘일자 - 한 달)
    AND 페이지수 >= 200;
```

2. 최근 할 달 이내에 도서 구독 멤버십에 가입한 회원 수 추출

```sql
SELECT * FROM 회원정보
  WHERE 가입일자 >= (오늘일자 - 한달)
   AND 멤버십 가입여부 = 1;
```
